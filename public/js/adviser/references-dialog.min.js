!function(e,n){"use strict";function t(e){return e.getDate()+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]+" "+e.getFullYear()}function r(e){var t='<button type="button" data-action="'+e.action+'"'+(e.className?' class="'+e.className+'"':"")+(e.autofocus?" autofocus":"")+">"+(e.icon?'<i aria-hidden="true" class="icon-'+e.icon+'"></i>':"")+e.text+"</button>";return n(t)[0]}function o(e,t){return n(e).on("submit",!1),n(t).addClass("button--submitting"),function(){n(e).off("submit"),n(t).removeClass("button--submitting")}}function a(t){t.preventDefault(),d||(v=r({action:"copy",text:E,icon:"copy",autofocus:!0}),p=r({action:"save",text:R,icon:"save"}),m=r({action:"clear",text:H,icon:"bin"}),h=r({action:"undo",text:I,icon:"undo",className:"hide"}),d=n.Dialog({title:B,className:"dialog--refs",footer:n([v,p,r({action:"load",icon:"load",text:S}),m,h,n('<a href="'+e.referenceHelpLink+'"><i aria-hidden="true" class="icon-help"></i>Help</a>')[0],r({action:"close",className:"right",text:D})])}).on("click","a[href]",function(){d.openedBy=null,d.close()}).on("click","[data-action=remove]",function(){var e=this.getAttribute("data-ref-key");F[e]=g.get(e),g.remove(e)}).on("click","[data-action=add]",function(){var e=this.getAttribute("data-ref-key"),n=F[e];delete F[e],g.add(n)}).on("click","[data-action=clear]",function(){g.clear()}).on("click","[data-action=undo]",function(){g.undoClear()}).on("click","[data-action=copy]",b).on("click","[data-action=save]",i).on("click","[data-action=load]",u).on("mouseenter focusin mouseleave focusout",".ref-dialog__item-button",function(e){n(this).closest("li").toggleClass("ref-dialog__list-item--highlight","mouseenter,focusin".indexOf(e.type)>-1)}),g.on("change",s)),s(),d.showModal()}function s(){var e=g.toArray(),t=g.clearAll;if(!t)for(var r in F)e.push(n.extend({removed:!0},F[r]));e=e.sort(function(e,n){return e.date-n.date});var o,a=n(document.activeElement);a.hasClass("ref-dialog__item-button")&&(o=a.data("ref-key"));var s=y.render({refs:e,clearAll:t},{item:w});d.$content.html(s);var b;o?b=d.$content.find('button.ref-dialog__item-button[data-ref-key="'+o+'"]'):a.is(m)&&t?b=n(h):a.is(h)&&!t&&(b=n(m)),n(m).toggleClass("hide",t),n(h).toggleClass("hide",!t),n([p,v,m]).attr("disabled",!g.count()),b&&b.focus()}function b(){var e=n.Dialog({title:$,className:"dialog--refs",destroyOnClose:!0,content:x.render({refs:g.toArray(),cmd:navigator.platform.indexOf("Mac")?"Cmd":"Ctrl",host:location.protocol+"//"+location.host}),footer:n(r({action:"close",text:D}))}).on("copy",function(){setTimeout(function(){e.close()},0)});e.showModal();var t=n(".ref-dialog__copy")[0];if(document.createRange){var o=window.getSelection(),a=document.createRange();a.selectNode(t),o.removeAllRanges(),o.addRange(a);try{if(document.execCommand("copy",null,null)===!1)throw 0;e.close()}catch(s){a.selectNode(t),o.removeAllRanges(),o.addRange(a)}t.contentEditable=!1}else if(document.body.createTextRange){var b=document.body.createTextRange();b.moveToElementText(t),b.select(),b.execCommand("copy",null,null),e.close()}}function i(){var e,t=(g.lastOwner||"").split("\\")[0],a=n.Dialog({title:j,className:"dialog--refs--save",destroyOnClose:!0,content:_.render({bureau:t,uniqueId:"6ae7b45c-8678-4851-96e5-ab6ffd2472da"}),footer:n([r({action:"close",text:q,icon:"cross"}),e=r({action:"save",text:R,icon:"save"})])}).on("close",function(){a.destroy()}).on("click","[data-action=save]",function(){a.$content.find("input[type=submit]").click()}).on("submit","form",function(n){n.preventDefault();var t=this.bureau.value.trim()+"\\"+this.name.value.trim(),r=o(this,e);g.serverLoad(t).then(function(e){return null!==e&&e.refs&&e.refs.length?c(e).then(function(e){return e?void 0:!1}):e}).then(function(e){return e!==!1?g.serverSave(t).then(function(){l(),a.close()}):void 0}).fail(function(e){r(),f(M,N.render({error:e.statusText}))})});a.showModal()}function c(e){var o=n.Deferred(),a=n.Dialog({title:J,destroyOnClose:!0,className:"dialog--refs",content:k.render({refs:e.refs,date:t(e.date)}),footer:n([r({action:"close",text:q,icon:"cross"}),r({action:"save",text:O,icon:"tick"})])}).on("click","[data-action=save]",function(){o.resolve(!0),a.close()}).on("close",function(){o.resolve(!1)});return a.showModal(),o.promise()}function l(){var e=g.lastOwner.split("\\");n.Dialog({title:L,className:"dialog--refs--save",destroyOnClose:!0,content:C.render({bureau:e[0],name:e.slice(1).join("\\")}),footer:n([r({action:"close",text:D,icon:"cross"})])}).showModal()}function u(){var e,t=(g.lastOwner||"").split("\\")[0],a=n.Dialog({title:Y,destroyOnClose:!0,className:"dialog--refs--save",content:T.render({bureau:t,uniqueId:"6ae7b45c-8678-4851-96e5-ab6ffd2472da"}),footer:n([r({action:"close",text:q,icon:"cross"}),e=r({action:"load",text:S,icon:"load"})])}).on("click","[data-action=load]",function(){a.$content.find("input[type=submit]").click()}).on("submit","form",function(n){n.preventDefault();var t=this.bureau.value.trim(),r=this.name.value.trim(),s=t+"\\"+r,b=o(this,e);g.serverLoad(s).then(function(e){a.close(),null!==e?(g.lastOwner=s,F={},g.replace(e.refs)):f(U,A.render({bureau:t,name:r}))}).fail(function(e){b(),f(M,N.render({error:e.statusText}))})});a.showModal()}function f(e,t){n.Dialog({title:e,destroyOnClose:!0,className:"dialog--refs--save",content:t,footer:n([r({action:"close",text:D,icon:"cross"})])}).showModal()}var d,p,v,m,h,g=window.CAB&&window.CAB.references,y=new Hogan.Template({code:function(e,n,t){var r=this;return r.b(t=t||""),r.s(r.d("refs.length",e,n,1),e,n,0,16,101,"{{ }}")&&(r.rs(e,n,function(e,n,r){r.b('<ul class="ref-dialog__list arrow-list">\r'),r.b("\n"+t),r.s(r.f("refs",e,n,1),e,n,0,69,83,"{{ }}")&&(r.rs(e,n,function(e,n,t){t.b(t.rp("<item0",e,n,""))}),e.pop()),r.b("</ul>\r"),r.b("\n"+t)}),e.pop()),r.s(r.d("refs.length",e,n,1),e,n,1,0,0,"")||(r.s(r.f("clearAll",e,n,1),e,n,0,150,300,"{{ }}")&&(r.rs(e,n,function(e,n,r){r.b("<p>\r"),r.b("\n"+t),r.b("References have been cleared \r"),r.b("\n"+t),r.b('<button type="button" data-action="undo">\r'),r.b("\n"+t),r.b('<i aria-hidden="true" class="icon-undo"></i>\r'),r.b("\n"+t),r.b("Undo\r"),r.b("\n"+t),r.b("</button>\r"),r.b("\n"+t),r.b("</p>\r"),r.b("\n"+t)}),e.pop()),r.s(r.f("clearAll",e,n,1),e,n,1,0,0,"")||(r.b("<p>No references have been added.</p>\r"),r.b("\n"+t))),r.fl()},partials:{"<item0":{name:"item",partials:{},subs:{}}},subs:{}}),w=new Hogan.Template({code:function(e,n,t){var r=this;return r.b(t=t||""),r.b('<li data-ref-key="'),r.b(r.v(r.f("key",e,n,0))),r.b('" class="ref-dialog__list-item'),r.s(r.f("removed",e,n,1),e,n,0,67,98,"{{ }}")&&(r.rs(e,n,function(e,n,t){t.b(" ref-dialog__list-item--removed")}),e.pop()),r.b('">\r'),r.b("\n"+t),r.s(r.f("removed",e,n,1),e,n,0,126,131,"{{ }}")&&(r.rs(e,n,function(e,n,t){t.b("<del>")}),e.pop()),r.b("\r"),r.b("\n"+t),r.b('<a href="'),r.b(r.v(r.f("url",e,n,0))),r.b('">\r'),r.b("\n"+t),r.b(r.v(r.f("title",e,n,0))),r.b(" \r"),r.b("\n"+t),r.b("("),r.b(r.v(r.f("extent",e,n,0))),r.b(")\r"),r.b("\n"+t),r.s(r.f("section",e,n,1),e,n,0,203,303,"{{ }}")&&(r.rs(e,n,function(e,n,r){r.b("ยง "),r.b(r.v(r.f("section",e,n,0))),r.b("\r"),r.b("\n"+t),r.s(r.f("paraStart",e,n,1),e,n,0,234,287,"{{ }}")&&(r.rs(e,n,function(e,n,t){t.b("("),t.b(t.v(t.f("paraStart",e,n,0))),t.s(t.f("paraEnd",e,n,1),e,n,0,260,274,"{{ }}")&&(t.rs(e,n,function(e,n,t){t.b(" - "),t.b(t.v(t.f("paraEnd",e,n,0)))}),e.pop()),t.b(")")}),e.pop()),r.b("\r"),r.b("\n"+t)}),e.pop()),r.b("</a>\r"),r.b("\n"+t),r.s(r.f("removed",e,n,1),e,n,0,335,341,"{{ }}")&&(r.rs(e,n,function(e,n,t){t.b("</del>")}),e.pop()),r.b("\r"),r.b("\n"+t),r.s(r.f("removed",e,n,1),e,n,0,367,571,"{{ }}")&&(r.rs(e,n,function(e,n,r){r.b('<button class="ref-dialog__item-button" type="button" data-action="add" data-ref-key="'),r.b(r.v(r.f("key",e,n,0))),r.b('"><i aria-hidden="true" class="icon-undo icon--no-text"></i><span class="screenreader">Undo</span></button>\r'),r.b("\n"+t)}),e.pop()),r.s(r.f("removed",e,n,1),e,n,1,0,0,"")||(r.b('<button class="ref-dialog__item-button" type="button" data-action="remove" data-ref-key="'),r.b(r.v(r.f("key",e,n,0))),r.b('"><i aria-hidden="true" class="icon-bin icon--no-text"></i><span class="screenreader">Delete</span></button>\r'),r.b("\n"+t)),r.b("</li>"),r.fl()},partials:{},subs:{}}),x=new Hogan.Template({code:function(e,n,t){var r=this;return r.b(t=t||""),r.b('<p>Press <strong class="key">'),r.b(r.v(r.f("cmd",e,n,0))),r.b('</strong> + <strong class="key">C</strong> or go to <strong>Edit</strong> then <strong>Copy</strong>, to copy.</p>\r'),r.b("\n"+t),r.b("\r"),r.b("\n"+t),r.b('<div class="ref-dialog__copy">\r'),r.b("\n"+t),r.s(r.f("refs",e,n,1),e,n,0,195,401,"{{ }}")&&(r.rs(e,n,function(e,n,r){r.b("<p>\r"),r.b("\n"+t),r.b('<a href="'),r.b(r.v(r.f("url",e,n,0))),r.b('">\r'),r.b("\n"+t),r.b(r.v(r.f("title",e,n,0))),r.b(" \r"),r.b("\n"+t),r.b("("),r.b(r.v(r.f("extent",e,n,0))),r.b(")\r"),r.b("\n"+t),r.s(r.f("section",e,n,1),e,n,0,260,360,"{{ }}")&&(r.rs(e,n,function(e,n,r){r.b("ยง "),r.b(r.v(r.f("section",e,n,0))),r.b("\r"),r.b("\n"+t),r.s(r.f("paraStart",e,n,1),e,n,0,291,344,"{{ }}")&&(r.rs(e,n,function(e,n,t){t.b("("),t.b(t.v(t.f("paraStart",e,n,0))),t.s(t.f("paraEnd",e,n,1),e,n,0,317,331,"{{ }}")&&(t.rs(e,n,function(e,n,t){t.b(" - "),t.b(t.v(t.f("paraEnd",e,n,0)))}),e.pop()),t.b(")")}),e.pop()),r.b("\r"),r.b("\n"+t)}),e.pop()),r.b("</a>\r"),r.b("\n"+t),r.b("<br>\r"),r.b("\n"+t),r.b(r.v(r.f("url",e,n,0))),r.b("\r"),r.b("\n"+t),r.b("</p>\r"),r.b("\n"+t)}),e.pop()),r.b("</div>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"+t),r.b("\r"),r.b("\n"+t),r.b("\r"),r.b("\n"),r.fl()},partials:{},subs:{}}),_=new Hogan.Template({code:function(e,n,t){var r=this;return r.b(t=t||""),r.b("<p>This will save the references to the server. They can then be loaded on another computer.</p>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"+t),r.b('<form class="form">\r'),r.b("\n"+t),r.b('<label for="bureau-'),r.b(r.v(r.f("uniqueId",e,n,0))),r.b('" class="form__row">\r'),r.b("\n"+t),r.b("Bureau name\r"),r.b("\n"+t),r.b('<input type="text" name="bureau" id="bureau-'),r.b(r.v(r.f("uniqueId",e,n,0))),r.b('" value="'),r.b(r.v(r.f("bureau",e,n,0))),r.b('" required pattern="[^\\\\]+" maxlength="100">\r'),r.b("\n"+t),r.b("</label>\r"),r.b("\n"+t),r.b('<label for="name-'),r.b(r.v(r.f("uniqueId",e,n,0))),r.b('" class="form__row">\r'),r.b("\n"+t),r.b("Your name\r"),r.b("\n"+t),r.b('<input type="text" name="name" id="name-'),r.b(r.v(r.f("uniqueId",e,n,0))),r.b('" required pattern="[^\\\\]+" maxlength="100">\r'),r.b("\n"+t),r.b("</label>\r"),r.b("\n"+t),r.b('<input type="submit" class="hide">\r'),r.b("\n"+t),r.b("</form>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"),r.fl()},partials:{},subs:{}}),k=new Hogan.Template({code:function(e,n,t){var r=this;return r.b(t=t||""),r.b("<p>You will overwrite the following references save on <strong>"),r.b(r.v(r.f("date",e,n,0))),r.b("</strong></p>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"+t),r.b("<ul>\r"),r.b("\n"+t),r.s(r.f("refs",e,n,1),e,n,0,103,270,"{{ }}")&&(r.rs(e,n,function(e,n,r){r.b("<li>\r"),r.b("\n"+t),r.b(r.v(r.f("title",e,n,0))),r.b(" \r"),r.b("\n"+t),r.b("("),r.b(r.v(r.f("extent",e,n,0))),r.b(")\r"),r.b("\n"+t),r.s(r.f("section",e,n,1),e,n,0,149,249,"{{ }}")&&(r.rs(e,n,function(e,n,r){r.b("ยง "),r.b(r.v(r.f("section",e,n,0))),r.b("\r"),r.b("\n"+t),r.s(r.f("paraStart",e,n,1),e,n,0,180,233,"{{ }}")&&(r.rs(e,n,function(e,n,t){t.b("("),t.b(t.v(t.f("paraStart",e,n,0))),t.s(t.f("paraEnd",e,n,1),e,n,0,206,220,"{{ }}")&&(t.rs(e,n,function(e,n,t){t.b(" - "),t.b(t.v(t.f("paraEnd",e,n,0)))}),e.pop()),t.b(")")}),e.pop()),r.b("\r"),r.b("\n"+t)}),e.pop()),r.b("</li>\r"),r.b("\n"+t)}),e.pop()),r.b("</ul>\r"),r.b("\n"+t),r.b("<p>Do you really want to save?</p>\r"),r.b("\n"),r.fl()},partials:{},subs:{}}),C=new Hogan.Template({code:function(e,n,t){var r=this;return r.b(t=t||""),r.b("<p>References successfully saved</p>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"+t),r.b("<p>To recover these references later you will need to enter the following details:</p>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"+t),r.b('<table class="table--properties">\r'),r.b("\n"+t),r.b("<tr>\r"),r.b("\n"+t),r.b('<th scope="row">Bureau name:</th>\r'),r.b("\n"+t),r.b("<td>"),r.b(r.v(r.f("bureau",e,n,0))),r.b("</td>\r"),r.b("\n"+t),r.b("</tr>\r"),r.b("\n"+t),r.b("<tr>\r"),r.b("\n"+t),r.b('<th scope="row">Your name:</th>\r'),r.b("\n"+t),r.b("<td>"),r.b(r.v(r.f("name",e,n,0))),r.b("</td>\r"),r.b("\n"+t),r.b("</tr>\r"),r.b("\n"+t),r.b("</table>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"),r.fl()},partials:{},subs:{}}),T=new Hogan.Template({code:function(e,n,t){var r=this;return r.b(t=t||""),r.b("<p>Retrieve references from the server.</p>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"+t),r.b("<p>This will replace the current references.</p>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"+t),r.b('<form class="form">\r'),r.b("\n"+t),r.b('<label for="bureau-'),r.b(r.v(r.f("uniqueId",e,n,0))),r.b('" class="form__row">\r'),r.b("\n"+t),r.b("Bureau name\r"),r.b("\n"+t),r.b('<input type="text" name="bureau" id="bureau-'),r.b(r.v(r.f("uniqueId",e,n,0))),r.b('" value="'),r.b(r.v(r.f("bureau",e,n,0))),r.b('" required pattern="[^\\\\]+" maxlength="100">\r'),r.b("\n"+t),r.b("</label>\r"),r.b("\n"+t),r.b('<label for="name-'),r.b(r.v(r.f("uniqueId",e,n,0))),r.b('" class="form__row">\r'),r.b("\n"+t),r.b("Your name\r"),r.b("\n"+t),r.b('<input type="text" name="name" id="name-'),r.b(r.v(r.f("uniqueId",e,n,0))),r.b('" required pattern="[^\\\\]+" maxlength="100">\r'),r.b("\n"+t),r.b("</label>\r"),r.b("\n"+t),r.b('<input type="submit" class="hide">\r'),r.b("\n"+t),r.b("</form>\r"),r.b("\n"+t),r.b("\r"),r.b("\n"),r.fl()},partials:{},subs:{}}),N=new Hogan.Template({code:function(e,n,t){var r=this;return r.b(t=t||""),r.b("<p><p>Sorry there has been an error. Please try again.\r"),r.b("\n"+t),r.b("<p>If the error persists please contact support.\r"),r.b("\n"+t),r.b('<p class="highlight--error">'),r.b(r.v(r.f("error",e,n,0))),r.fl()},partials:{},subs:{}}),A=new Hogan.Template({code:function(e,n,t){var r=this;return r.b(t=t||""),r.b('<p class="highlight--warning">\r'),r.b("\n"+t),r.b("No references found on the server stored under <strong>"),r.b(r.v(r.f("bureau",e,n,0))),r.b("</strong> and <strong>"),r.b(r.v(r.f("name",e,n,0))),r.b("</strong>.\r"),r.b("\n"+t),r.b("</p>\r"),r.b("\n"),r.fl()},partials:{},subs:{}}),D="Close",q="Cancel",R="Save",O="Yes",S="Retrieve",E="Copy",H="Clear",I="Undo",M="Error",B="References",Y="Retrieve from server",$="Copy references",j="Save to server",J="Confirm save",L="Saved",U="No references found",F={};g&&n(".js-ref-dialog").on("click",a)}(window.CAB,jQuery);
//# sourceMappingURL=references-dialog.min.js.map